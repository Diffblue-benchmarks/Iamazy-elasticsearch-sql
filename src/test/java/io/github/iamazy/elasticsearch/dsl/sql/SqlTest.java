package io.github.iamazy.elasticsearch.dsl.sql;

import io.github.iamazy.elasticsearch.dsl.sql.model.ElasticSqlParseResult;
import io.github.iamazy.elasticsearch.dsl.sql.parser.ElasticSql2DslParser;
import org.junit.Test;

/**
 * @author iamazy
 * @date 2019/4/12
 * @descrition
 **/
public class SqlTest {

    @Test
    public void test(){
        String sql="select * from device_search query function_score( term(h#deviceLocation.zhCountry,'中国'),weight(deviceLocation.country is not null,2),weight($vulVerifyList.solution is not null,2),weight($vulVerifyList.vulType is not null,2),weight(deviceLocation.operator is not null,2),weight(protocol is not null,2),weight(deviceLocation.province is not null,2),weight(osInfo.lastModified is not null,2),weight($softInfo.softType is not null,2),weight(deviceInfo.createDate is not null,2),weight($softInfo.softBrand is not null,2),weight(deviceInfo.typeSim is not null,2),weight(deviceLocation.createDate is not null,2),weight(deviceInfo.deviceType is not null,2),weight(deviceLocation.coordinate is not null,2),weight(ip is not null,2),weight(deviceLocation.lastModified is not null,2),weight($vulVerifyList.lastModified is not null,2),weight(deviceInfo.brandSim is not null,2),weight(deviceLocation.zhCity is not null,2),weight(deviceLocation.areaCode is not null,2),weight(deviceInfo.deviceCategory is not null,2),weight(deviceInfo.lastModified is not null,2),weight(port is not null,2),weight(deviceLocation.zhProvince is not null,2),weight(deviceLocation.district is not null,2),weight($vulVerifyList.vulExist is not null,2),weight(lastModified is not null,2),weight(deviceLocation.zhDistrict is not null,2),weight($vulVerifyList.vulId is not null,2),weight(deviceInfo.deviceBrand is not null,2),weight($softInfo.lastModified is not null,2),weight($softInfo.version is not null,2),weight($softInfo.softProduct is not null,2),weight(deviceLocation.city is not null,2),weight(deviceLocation.cityCode is not null,2),weight(deviceLocation.timezone is not null,2),weight(deviceInfo.manufacturer is not null,2),weight(deviceInfo.categorySim is not null,2),weight(osInfo.osGeneration is not null,2),weight($softInfo.category is not null,2),weight($vulVerifyList.baseScore is not null,2),weight($softInfo.createDate is not null,2),weight(deviceLocation.countryCode is not null,2),weight($vulVerifyList.vectorString is not null,2),weight(osInfo.osVendor is not null,2),weight(createDate is not null,2),weight(deviceLocation.owner is not null,2),weight(deviceLocation.address is not null,2),weight(osInfo.osFamily is not null,2),weight($osInfo.createDate is not null,2),weight($vulVerifyList.riskLevel is not null,2),weight($vulVerifyList.vulName is not null,2),weight(deviceLocation.provinceCode is not null,2),weight($vulVerifyList.desc is not null,2),weight(banner is not null,2),weight($vulVerifyList.createDate is not null,2),weight(deviceLocation.zhCountry is not null,2),weight(deviceInfo.modelSim is not null,2),weight(deviceInfo.deviceModel is not null,2),weight(deviceInfo.firmVersion is not null,2),weight(deviceLocation.coordinate is not null,2),weight(ip is not null,2),weight(deviceLocation.lastModified is not null,2),weight($vulVerifyList.lastModified is not null,2),weight(deviceInfo.brandSim is not null,2),weight(deviceLocation.zhCity is not null,2),weight(deviceLocation.areaCode is not null,2),weight(deviceInfo.deviceCategory is not null,2),weight(deviceInfo.lastModified is not null,2),weight(port is not null,2),weight(deviceLocation.zhProvince is not null,2),weight(deviceLocation.district is not null,2),weight($vulVerifyList.vulExist is not null,2),weight(lastModified is not null,2),weight(deviceLocation.zhDistrict is not null,2),weight($vulVerifyList.vulId is not null,2),weight(deviceInfo.deviceBrand is not null,2),weight($softInfo.lastModified is not null,2),weight($softInfo.version is not null,2),weight($softInfo.softProduct is not null,2),weight(deviceLocation.city is not null,2),weight(deviceLocation.cityCode is not null,2),weight(deviceLocation.timezone is not null,2),weight(deviceInfo.manufacturer is not null,2),weight(deviceInfo.categorySim is not null,2),weight(osInfo.osGeneration is not null,2),weight($softInfo.category is not null,2),weight($vulVerifyList.baseScore is not null,2),weight($softInfo.createDate is not null,2),weight(deviceLocation.countryCode is not null,2),weight($vulVerifyList.vectorString is not null,2),weight(osInfo.osVendor is not null,2),weight(createDate is not null,2),weight(deviceLocation.owner is not null,2),weight(deviceLocation.address is not null,2),weight(osInfo.osFamily is not null,2),weight($osInfo.createDate is not null,2),weight($vulVerifyList.riskLevel is not null,2),weight($vulVerifyList.vulName is not null,2),weight(deviceLocation.provinceCode is not null,2),weight($vulVerifyList.desc is not null,2),weight(banner is not null,2),weight($vulVerifyList.createDate is not null,2),weight(deviceLocation.zhCountry is not null,2),weight(deviceInfo.modelSim is not null,2),weight(deviceInfo.deviceModel is not null,2),weight(taskId is not null,2),weight(deviceInfo.firmVersion is not null,2)) order by lastModified desc limit 0,20";
        ElasticSql2DslParser elasticSql2DslParser=new ElasticSql2DslParser();
        ElasticSqlParseResult elasticSqlParseResult = elasticSql2DslParser.parse(sql);
        System.out.println(elasticSqlParseResult.toPrettyDsl(elasticSqlParseResult.toRequest()));
    }
}
